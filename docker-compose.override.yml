version: '3.7'
services:
  caddy:
    volumes:
      - ./sourcegraph-data/caddy:/etc/caddy
  gitserver-0:
    volumes:
      - ./sourcegraph-data/gitserver:/data/repos
  pgsql:
    volumes:
      - ./sourcegraph-data/pgsql:/var/lib/postgresql/data
  codeintel-db:
    volumes:
      - ./sourcegraph-data/codeintel-db:/var/lib/postgresql/data
  codeinsights-db:
    # Use a simple bind mount without the nocopy option
    volumes:
      - ./sourcegraph-data/codeinsights-db:/var/lib/postgresql/data
  redis-cache:
    volumes:
      - ./sourcegraph-data/redis-cache:/redis-data
  redis-store:
    volumes:
      - ./sourcegraph-data/redis-store:/redis-data
  blobstore:
    volumes:
      - ./sourcegraph-data/blobstore:/data
  zoekt-indexserver-0:
    volumes:
      - ./sourcegraph-data/zoekt:/data/index
  zoekt-webserver-0:
    volumes:
      - ./sourcegraph-data/zoekt:/data/index
  prometheus:
    volumes:
      - ./sourcegraph-data/prometheus:/prometheus
      
# Override/disable the volumes defined in the main docker-compose.yaml file
volumes:
  codeinsights-db:
    driver: local
    driver_opts:
      type: none
      device: ./sourcegraph-data/codeinsights-db
      o: bind
