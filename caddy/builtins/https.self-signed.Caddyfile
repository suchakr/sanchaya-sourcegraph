{
    # Tell Caddy this is explicitly an HTTPS site
    auto_https disable_redirects
    
    # Global options for all sites
    # Use self-signed certificates
    local_certs
}

# Define the site with HTTPS explicitly
https://{$SRC_SITE_ADDRESS} {
    tls internal
    reverse_proxy sourcegraph-frontend-0:3080
}

# Redirect HTTP to HTTPS
http://{$SRC_SITE_ADDRESS} {
    redir https://{$SRC_SITE_ADDRESS}{uri} permanent
}
